package com.jacoblucas.adventofcode2021.day16;

import com.google.common.collect.ImmutableList;
import org.junit.Test;

import static org.hamcrest.CoreMatchers.is;
import static org.junit.Assert.assertThat;

public class PacketDecoderTest {

    @Test
    public void testHexToBinary() {
        assertThat(PacketDecoder.hexToBinary("D2FE28"), is("110100101111111000101000"));
    }

    @Test // the actual day 16 input string
    public void testHexToBinaryReallyLarge() {
        final String hex = "420D598021E0084A07C98EC91DCAE0B880287912A925799429825980593D7DCD400820329480BF21003CC0086028910097520230C80813401D8CC00F601881805705003CC00E200E98400F50031801D160048E5AFEFD5E5C02B93F2F4C11CADBBB799CB294C5FDB8E12C40139B7C98AFA8B2600DCBAF4D3A4C27CB54EA6F5390B1004B93E2F40097CA2ECF70C1001F296EF9A647F5BFC48C012C0090E675DF644A675DF645A7E6FE600BE004872B1B4AAB5273ED601D2CD240145F802F2CFD31EFBD4D64DD802738333992F9FFE69CAF088C010E0040A5CC65CD25774830A80372F9D78FA4F56CB6CDDC148034E9B8D2F189FD002AF3918AECD23100953600900021D1863142400043214C668CB31F073005A6E467600BCB1F4B1D2805930092F99C69C6292409CE6C4A4F530F100365E8CC600ACCDB75F8A50025F2361C9D248EF25B662014870035600042A1DC77890200D41086B0FE4E918D82CC015C00DCC0010F8FF112358002150DE194529E9F7B9EE064C015B005C401B8470F60C080371460CC469BA7091802F39BE6252858720AC2098B596D40208A53CBF3594092FF7B41B3004A5DB25C864A37EF82C401C9BCFE94B7EBE2D961892E0C1006A32C4160094CDF53E1E4CDF53E1D8005FD3B8B7642D3B4EB9C4D819194C0159F1ED00526B38ACF6D73915F3005EC0179C359E129EFDEFEEF1950005988E001C9C799ABCE39588BB2DA86EB9ACA22840191C8DFBE1DC005EE55167EFF89510010B322925A7F85A40194680252885238D7374C457A6830C012965AE00D4C40188B306E3580021319239C2298C4ED288A1802B1AF001A298FD53E63F54B7004A68B25A94BEBAAA00276980330CE0942620042E3944289A600DC388351BDC00C9DCDCFC8050E00043E2AC788EE200EC2088919C0010A82F0922710040F289B28E524632AE0";
        assertThat(PacketDecoder.hexToBinary(hex), is("01000010000011010101100110000000001000011110000000001000010010100000011111001001100011101100100100011101110010101110000010111000100000000010100001111001000100101010100100100101011110011001010000101001100000100101100110000000010110010011110101111101110011010100000000001000001000000011001010010100100000001011111100100001000000000011110011000000000010000110000000101000100100010000000010010111010100100000001000110000110010000000100000010011010000000001110110001100110000000000111101100000000110001000000110000000010101110000010100000000001111001100000000001110001000000000111010011000010000000000111101010000000000110001100000000001110100010110000000000100100011100101101011111110111111010101111001011100000000101011100100111111001011110100110000010001110010101101101110111011011110011001110010110010100101001100010111111101101110001110000100101100010000000001001110011011011111001001100010101111101010001011001001100000000011011100101110101111010011010011101001001100001001111100101101010100111010100110111101010011100100001011000100000000010010111001001111100010111101000000000010010111110010100010111011001111011100001100000100000000000111110010100101101110111110011010011001000111111101011011111111000100100011000000000100101100000000001001000011100110011101011101111101100100010010100110011101011101111101100100010110100111111001101111111001100000000010111110000000000100100001110010101100011011010010101010101101010010011100111110110101100000000111010010110011010010010000000001010001011111100000000010111100101100111111010011000111101111101111010100110101100100110111011000000000100111001110000011001100111001100100101111100111111111111001101001110010101111000010001000110000000001000011100000000001000000101001011100110001100101110011010010010101110111010010000011000010101000000000110111001011111001110101111000111110100100111101010110110010110110110011011101110000010100100000000011010011101001101110001101001011110001100010011111110100000000001010101111001110010001100010101110110011010010001100010000000010010101001101100000000010010000000000000010000111010001100001100011000101000010010000000000000001000011001000010100110001100110100011001011001100011111000001110011000000000101101001101110010001100111011000000000101111001011000111110100101100011101001010000000010110010011000000001001001011111001100111000110100111000110001010010010010000001001110011100110110001001010010011110101001100001111000100000000001101100101111010001100110001100000000010101100110011011011011101011111100010100101000000000010010111110010001101100001110010011101001001001000111011110010010110110110011000100000000101001000011100000000001101010110000000000000010000101010000111011100011101111000100100000010000000001101010000010000100001101011000011111110010011101001000110001101100000101100110000000001010111000000000011011100110000000000000100001111100011111111000100010010001101011000000000000010000101010000110111100001100101000101001010011110100111110111101110011110111000000110010011000000000101011011000000000101110001000000000110111000010001110000111101100000110000001000000000110111000101000110000011001100010001101001101110100111000010010001100000000010111100111001101111100110001001010010100001011000011100100000101011000010000010011000101101011001011011010100000000100000100010100101001111001011111100110101100101000000100100101111111101111011010000011011001100000000010010100101110110110010010111001000011001001010001101111110111110000010110001000000000111001001101111001111111010010100101101111110101111100010110110010110000110001001001011100000110000010000000001101010001100101100010000010110000000001001010011001101111101010011111000011110010011001101111101010011111000011101100000000000010111111101001110111000101101110110010000101101001110110100111010111001110001001101100000011001000110010100110000000001010110011111000111101101000000000101001001101011001110001010110011110110110101110011100100010101111100110000000001011110110000000001011110011100001101011001111000010010100111101111110111101111111011101111000110010101000000000000010110011000100011100000000000011100100111000111100110011010101111001110001110010101100010001011101100101101101010000110111010111001101011001010001000101000010000000001100100011100100011011111101111100001110111000000000001011110111001010101000101100111111011111111100010010101000100000000000100001011001100100010100100100101101001111111100001011010010000000001100101000110100000000010010100101000100001010010001110001101011100110111010011000100010101111010011010000011000011000000000100101001011001011010111000000000110101001100010000000001100010001011001100000110111000110101100000000000001000010011000110010010001110011100001000101001100011000100111011010010100010001010000110000000001010110001101011110000000000011010001010011000111111010101001111100110001111110101010010110111000000000100101001101000101100100101101010010100101111101011101010101010000000000010011101101001100000000011001100001100111000001001010000100110001000000000010000101110001110010100010000101000100110100110000000001101110000111000100000110101000110111101110000000000110010011101110011011100111111001000000001010000111000000000000001000011111000101010110001111000100011101110001000000000111011000010000010001000100100011001110000000000000100001010100000101111000010010010001001110001000000000100000011110010100010011011001010001110010100100100011000110010101011100000"));
    }

    @Test
    public void testBinaryToDecimal() {
        assertThat(PacketDecoder.binaryToDecimal("110"), is(6L));
    }

    @Test
    public void testDecodeLiteral() {
        final Packet literal = PacketDecoder.decodeLiteral("0001000101010110001011");
        final Packet expected = new LiteralPacket("00010001010");

        assertThat(literal, is(expected));
    }

    @Test
    public void testDecodeOperatorLengthTypeZero() {
        String binaryString = "00000000000000000101100001000101010110001011001000100000000010000100011000111000110100";
        final Packet operator = PacketDecoder.decodeOperator(binaryString);
        final Packet expected = new OperatorPacket("00000000000000000101100001000101010110001011", ImmutableList.of(
                new LiteralPacket("00010001010"),
                new LiteralPacket("10110001011")));

        assertThat(operator, is(expected));
    }

    @Test
    public void testDecodeOperatorLengthTypeOne() {
        String binaryString = "001000100000000010000100011000111000110100";
        final Packet operator = PacketDecoder.decodeOperator(binaryString);
        final Packet expected = new OperatorPacket("0010001000000000100001000110001110001101", ImmutableList.of(
                new LiteralPacket("00010001100"),
                new LiteralPacket("01110001101")));

        assertThat(operator, is(expected));
    }

    @Test
    public void testGetVersionSumExample1() {
        assertThat(PacketDecoder.decodeHex("8A004A801A8002F478").getVersionSum(), is(16));
    }

    @Test
    public void testGetVersionSumExample2() {
        // 01100010000000001000000000000000000101100001000101010110001011001000100000000010000100011000111000110100
        //
        // [011000|1|00000000010| [000000|0|000000000010110| [000100|01010] [101100|01011] ] [001000|1|00000000010| [000100|01100] [011100|01101] 00]
        //   3  1         2         0  0          22           0  4    10     5  4    11       1  0          2        0  4    12     3  4    13
        assertThat(PacketDecoder.decodeHex("620080001611562C8802118E34").getVersionSum(), is(12));
    }

    @Test
    public void testGetVersionSumExample3() {
        assertThat(PacketDecoder.decodeHex("C0015000016115A2E0802F182340").getVersionSum(), is(23));
    }

    @Test
    public void testGetVersionSumExample4() {
        assertThat(PacketDecoder.decodeHex("A0016C880162017C3686B18A3D4780").getVersionSum(), is(31));
    }
}
